<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<title>è‚¡å¸‚æ¸¸æˆ</title>
		<style>
			:root {
				--bg: #020617;
				--panel: #020617dd;
				--line: #38bdf8;
				--grid: #1e293b;
				--text: #eee;
				--green: #22c55e;
				--red: #ef4444;
				--news: #fde047
			}

			body {
				margin: 0;
				background: radial-gradient(circle at top, #020617, #000);
				color: var(--text);
				font-family: sans-serif
			}

			#start {
				position: fixed;
				inset: 0;
				display: flex;
				align-items: center;
				justify-content: center;
				background: radial-gradient(circle at top, #333 0, #000 70%);
				z-index: 10
			}

			#start.fade-out {
				animation: start-fade-out .6s ease forwards
			}

			@keyframes start-fade-out {
				to {
					opacity: 0;
					transform: translateY(-20px) scale(0.96)
				}
			}

			.start-panel {
				text-align: center;
				padding: 48px 60px;
				animation: start-fade-in .8s ease
			}

			.start-panel h1 {
				margin: 0;
				font-size: 56px;
				letter-spacing: 4px;
				font-weight: 700
			}

			.start-panel .subtitle {
				margin-top: 10px;
				font-size: 14px;
				letter-spacing: 2px;
				color: #b9b9b9;
				text-transform: uppercase
			}

			#start button {
				margin-top: 36px;
				font-size: 20px;
				padding: 14px 48px;
				border-radius: 999px;
				border: 0;
				background: linear-gradient(135deg, #b7f1d9, #0af);
				color: #000;
				font-weight: 600;
				cursor: pointer;
				box-shadow: 0 10px 30px rgba(69, 248, 228, .3);
				transition: transform .15s ease, box-shadow .15s ease
			}

			#start button:hover {
				transform: scale(1.05);
				box-shadow: 0 20px 40px rgba(69, 248, 228, .6)
			}

			#start button:active {
				transform: scale(0.96)
			}

			.start-panel .tip {
				margin-top: 22px;
				font-size: 13px;
				color: #b9b9b9;
				opacity: .9
			}

			.start-panel a {
				color: #b9b9b9
			}

			@keyframes start-fade-in {
				from {
					opacity: 0;
					transform: translateY(20px) scale(0.96)
				}

				to {
					opacity: 1;
					transform: none
				}
			}

			#top {
				display: flex;
				justify-content: space-between;
				padding: 12px 20px;
				font-size: 18px
			}

			#chartWrap {
				width: 900px;
				margin: 0 auto;
				background: #020617;
				border-radius: 14px;
				box-shadow: inset 0 0 0 1px var(--grid);
				display: flex;
				gap: 12px;
				padding: 12px;
				position: relative
			}

			svg {
				display: block
			}

			#panel {
				text-align: center;
				margin: 16px;
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			.tradeControls {
				display: flex;
				align-items: center;
				gap: 12px;
				margin-bottom: 6px
			}

			.tradeControls button {
				padding: 6px 12px;
				border-radius: 12px;
				border: 0;
				background: #374151;
				color: #fff;
				font-size: 16px;
				cursor: pointer
			}

			#buy,
			#sell {
				font-size: 18px;
				padding: 10px 28px;
				margin: 0 12px;
				border-radius: 14px;
				border: 0;
				cursor: pointer
			}

			#buy {
				background: var(--green)
			}

			#sell {
				background: var(--red)
			}

			.tradeAmount {
				color: #94a3b8;
				margin-top: 4px;
				font-size: 14px
			}

			button:active {
				transform: scale(.95)
			}

			.toast {
				position: fixed;
				right: 30px;
				top: 30px;
				background: var(--panel);
				border: 1px solid var(--news);
				padding: 16px;
				border-radius: 20px;
				animation: toast-impact .6s cubic-bezier(.2, 1.8, .4, 1), toast-out .6s ease 3.6s forwards
			}

			.news {
				position: fixed;
				left: 50%;
				bottom: 24px;
				transform: translateX(-50%);
				background: #020617ee;
				border: 1px solid var(--news);
				padding: 20px;
				border-radius: 20px;
				color: var(--news);
				font-size: 16px;
				pointer-events: none;
				animation: news-in .6s cubic-bezier(.2, 1.4, .4, 1), news-out .8s ease 4.2s forwards
			}

			@keyframes news-in {
				from {
					opacity: 0;
					transform: translateX(-50%) translateY(20px) scale(.95)
				}

				to {
					opacity: 1;
					transform: translateX(-50%) translateY(0) scale(1)
				}
			}

			@keyframes news-out {
				to {
					opacity: 0;
					transform: translateX(-50%) translateY(-20px) scale(.9)
				}
			}

			@keyframes toast-impact {
				0% {
					opacity: 0;
					transform: scale(0.5) translateX(40px);
					box-shadow: 0 0 0 rgba(56, 189, 248, 0);
					border-color: transparent
				}

				35% {
					opacity: 1;
					transform: scale(1.2);
					box-shadow: 0 0 30px rgba(56, 189, 248, 1);
					border-color: var(--line)
				}

				100% {
					transform: scale(1);
					box-shadow: 0 0 12px rgba(56, 189, 248, .4)
				}
			}

			@keyframes toast-out {
				to {
					opacity: 0;
					transform: translateY(-10px) scale(.95)
				}
			}

			#rankMask,
			#achvMask,
			#ruleMask,
			#deadMask,
			#delistMask {
				position: fixed;
				inset: 0;
				background: rgba(0, 0, 0, .6);
				display: none;
				align-items: center;
				justify-content: center;
				border-color: var(--news);
				z-index: 20
			}

			#rankPanel,
			#achvPanel,
			#rulePanel,
			#deadPanel,
			#delistPanel {
				background: #020617;
				border-radius: 16px;
				padding: 20px;
				width: 420px;
				border-color: var(--news);
				max-width: 90%
			}

			.rankItem {
				display: flex;
				justify-content: space-between;
				padding: 10px 14px;
				border-radius: 10px;
				margin-bottom: 8px;
				background: #111827
			}

			#achvBtn,
			#rankBtn,
			#updateRankBtn,
			#resetBtn,
			#ruleBtn {
				background: #111827;
				color: #facc15;
				border: 1px solid #374151;
				border-radius: 10px;
				padding: 6px 14px;
				cursor: pointer;
				margin-left: 6px
			}

			#achvList {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 10px
			}

			.achvItem {
				padding: 12px;
				border-radius: 12px;
				text-align: center;
				font-size: 14px
			}

			.achvItem.locked {
				background: #1f2933;
				color: #6b7280
			}

			.achvItem.unlocked {
				background: linear-gradient(135deg, #facc15, #f59e0b);
				color: #000;
				font-weight: 600
			}

			#deadPanel {
				text-align: center;
				border: 1px solid #7f1d1d;
				border-radius: 20px;
				padding: 26px 34px
			}

			#deadPanel h1 {
				margin: 0 0 12px;
				color: #ef4444
			}

			#deadPanel button {
				margin-top: 14px;
				padding: 10px 28px;
				border-radius: 14px;
				border: 0;
				background: #ef4444;
				color: #000;
				font-size: 16px;
				cursor: pointer
			}

			#delistPanel {
				text-align: center;
				border: 1px solid #facc15;
				border-radius: 20px;
				padding: 26px 34px
			}

			#delistPanel h1 {
				margin: 0 0 12px;
				color: #facc15
			}

			#overviewSvg {
				width: 180px;
				height: 120px;
				position: absolute;
				right: 20px;
				top: 59px;
				background: #020617cc;
				border-radius: 10px;
				box-shadow: 0 0 0 1px var(--grid);
				filter: blur(1px)
			}
		</style>
	</head>
	<body>

		<div id="start">
			<div class="start-panel">
				<h1>è‚¡å¸‚æ¸¸æˆ</h1>
				<p class="subtitle">åœ¨æç«¯å˜åŒ–çš„å¸‚åœºä¸­ç”Ÿå­˜</p>
				<button onclick="startGame()">è¿›å…¥å¸‚åœº</button>
				<p class="tip">Game made by <a href="https://github.com/zhujingqi">Jacky</a> Â· <a
						href="https://zhujingqi.com">zhujingqi.com</a></p>
			</div>
		</div>

		<div id="top">
			<div id="money"></div>
			<div id="stock"></div>
			<button id="achvBtn">ğŸ† æˆå°±</button>
			<button id="rankBtn">ğŸ¥‡ æ’è¡Œæ¦œ</button>
			<button id="updateRankBtn">â¬†ï¸ æäº¤ç›®å‰åˆ†æ•°è‡³æ’è¡Œæ¦œ</button>
			<button id="ruleBtn">ğŸ“œ è§„åˆ™</button>
			<button id="resetBtn" onclick="localStorage.removeItem('achv-final');location.reload()">é‡ç½®æˆå°±</button>
		</div>

		<div id="chartWrap">
			<svg id="mainSvg" width="900" height="360">
				<g id="grid"></g>
				<g id="axis"></g>
				<polyline id="line" fill="none" stroke="var(--line)" stroke-width="2" />
				<g id="trades"></g>
			</svg>
			<svg id="overviewSvg">
				<polyline id="overviewLine" fill="none" stroke="var(--line)" stroke-width="1.5" opacity="0.9" />
			</svg>
		</div>

		<div id="panel">
			<div class="tradeControls">
				<button id="decBuy">-</button>
				<button id="buy">BUY</button>
				<button id="incBuy">+</button>
				<span class="tradeAmount" id="buyAmount">1</span>
			</div>
			<div class="tradeControls">
				<button id="decSell">-</button>
				<button id="sell">SELL</button>
				<button id="incSell">+</button>
				<span class="tradeAmount" id="sellAmount">1</span>
			</div>
		</div>

		<div id="achvMask">
			<div id="achvPanel">
				<h2>ğŸ† æˆå°±</h2>
				<div id="achvList"></div>
				<h6>
					<center>ç‚¹å‡»ç©ºç™½å¤„å…³é—­</center>
				</h6>
			</div>
		</div>
		<div id="rankMask">
			<div id="rankPanel">
				<h2>ğŸ… æ’è¡Œæ¦œ</h2>
				<div id="rankList"></div>
				<h6>
					<center>ç‚¹å‡»ç©ºç™½å¤„å…³é—­</center>
				</h6>
			</div>
		</div>
		<div id="ruleMask">
			<div id="rulePanel">
				<h2>ğŸ“œ æ¸¸æˆè§„åˆ™</h2>
				<div id="ruleContent">
					<p><b>ğŸ¯ ç›®æ ‡</b><br>åœ¨æç«¯æ³¢åŠ¨çš„å¸‚åœºä¸­å­˜æ´»å¹¶ç§¯ç´¯èµ„äº§ã€‚</p>
					<p><b>ğŸ’° åˆå§‹çŠ¶æ€</b><br>åˆå§‹èµ„é‡‘ï¼š$500<br>åˆå§‹è‚¡ç¥¨ï¼š0<br>åˆå§‹ä»·æ ¼ï¼š$100</p>
					<p><b>ğŸ“ˆ å¸‚åœºæœºåˆ¶</b><br>- ä»·æ ¼æ¯ 300ms å˜åŒ–ä¸€æ¬¡<br>- éšæœºé«˜æ³¢åŠ¨äº‹ä»¶<br>- ä»·æ ¼ä¸ä½äº $1<br>- è‚¡ç¥¨è·Œè‡³ $1 ä¸‹å¸‚ 5-15 ç§’åé‡æ–°ä¸Šå¸‚ï¼Œä»·æ ¼é‡ç½®ä¸º
						$100</p>
					<p><b>ğŸ›’ äº¤æ˜“è§„åˆ™</b><br>- BUY/SELL æŒ‰é’®å·¦å³ç®­å¤´æ§åˆ¶ä¹°å–æ•°é‡<br>- å¦‚æœèµ„é‡‘ä¸è¶³ï¼Œä¸å…è®¸ä¹°å…¥</p>
					<p><b>â˜ ï¸ ç ´äº§åˆ¤å®š</b><br>ç°é‡‘ä¸è¶³ä¹°å…¥ä¸”æŒè‚¡ä¸º 0 æ—¶ç»“æŸæ¸¸æˆã€‚</p>
					<p>Game made by <a href="https://github.com/zhujingqi">Jacky</a> Â· <a
							href="https://zhujingqi.com">zhujingqi.com</a></p>
					<h6>
						<center>ç‚¹å‡»ç©ºç™½å¤„å…³é—­</center>
					</h6>
				</div>
			</div>
		</div>

		<div id="deadMask">
			<div id="deadPanel">
				<h1>ğŸ’€ ç ´äº§</h1>
				<p id="deadInfo"></p><button onclick="location.reload()">é‡æ–°å¼€å§‹</button>
			</div>
		</div>
		<div id="delistMask">
			<div id="delistPanel">
				<h1>ğŸ“‰ è‚¡ç¥¨å·²ä¸‹å¸‚</h1>
				<p>ç­‰å¾…é‡æ–°ä¸Šå¸‚...</p>
			</div>
		</div>

		<script>
			/* ===== config ===== */
			const W = 900,
				H = 360,
				maxPoints = 120,
				tickInterval = 300;
			let money = 500,
				stock = 0,
				price = 100,
				alive = false,
				data = [],
				trades = [],
				shock = 1,
				smoothCenter = price,
				lastTradeTime = Date.now(),
				tradeTimes = [];
			let buyQty = 1,
				sellQty = 1,
				delisted = false;
			/* ===== dom ===== */
			const moneyDiv = document.getElementById('money'),
				stockDiv = document.getElementById('stock'),
				lineEl = document.getElementById('line'),
				axisG = document.getElementById('axis'),
				gridG = document.getElementById('grid'),
				tradesG = document.getElementById('trades'),
				deadMask = document.getElementById('deadMask'),
				deadInfo = document.getElementById('deadInfo'),
				overviewLine = document.getElementById('overviewLine'),
				delistMask = document.getElementById('delistMask'),
				OW = 180,
				OH = 120;
			const achvMask = document.getElementById('achvMask'),
				achvList = document.getElementById('achvList'),
				achvBtn = document.getElementById('achvBtn');
			const rankMask = document.getElementById('rankMask'),
				rankList = document.getElementById('rankList'),
				rankBtn = document.getElementById('rankBtn'),
				updateRankBtn = document.getElementById('updateRankBtn');
			const ruleMask = document.getElementById('ruleMask'),
				ruleBtn = document.getElementById('ruleBtn');
			const start = document.getElementById('start');
			const buy = document.getElementById('buy'),
				sell = document.getElementById('sell');
			const incBuy = document.getElementById('incBuy'),
				decBuy = document.getElementById('decBuy'),
				buyAmount = document.getElementById('buyAmount');
			const incSell = document.getElementById('incSell'),
				decSell = document.getElementById('decSell'),
				sellAmount = document.getElementById('sellAmount');

			/* ===== achievements ===== */
			const achv = {
				first: false,
				banker: false,
				senior: false,
				survivor: false,
				rich: false,
				still: false,
				fast: false,
				alive: false
			};
			Object.assign(achv, JSON.parse(localStorage.getItem('achv-final') || '{}'));

			function saveAchv() {
				localStorage.setItem('achv-final', JSON.stringify(achv));
			}

			function toast(t) {
				const d = document.createElement('div');
				d.className = 'toast';
				d.textContent = 'ğŸ† ' + t;
				document.body.appendChild(d);
				setTimeout(() => d.remove(), 5000);
			}

			function unlock(k, name) {
				if (!achv[k]) {
					achv[k] = true;
					saveAchv();
					toast(name);
				}
			}

			/* ===== start ===== */
			function startGame() {
				start.classList.add('fade-out');
				setTimeout(() => {
					start.style.display = 'none';
				}, 600);
				alive = true;
				data = [];
				smoothCenter = price;
				for (let i = 0; i < maxPoints; i++) data.push(price);
			}

			/* ===== ui ===== */
			function ui() {
				moneyDiv.textContent = 'ğŸ’° $' + money.toFixed(2);
				stockDiv.textContent = 'ğŸ“¦ ' + stock;
			}

			/* ===== draw ===== */
			function draw() {
				if (data.length < 2) return;
				const cur = data.length - 1,
					startIndex = Math.max(0, cur - Math.floor(maxPoints / 2)),
					view = data.slice(startIndex, startIndex + maxPoints);
				smoothCenter = smoothCenter * 0.9 + price * 0.1;
				const range = 50,
					minY = smoothCenter - range,
					maxY = smoothCenter + range;
				gridG.innerHTML = '';
				axisG.innerHTML = '';
				for (let p = Math.floor(minY / 10) * 10; p <= maxY; p += 10) {
					const y = (maxY - p) / (maxY - minY) * H;
					let gl = document.createElementNS('http://www.w3.org/2000/svg', 'line');
					gl.setAttribute('x1', 0);
					gl.setAttribute('x2', W);
					gl.setAttribute('y1', y);
					gl.setAttribute('y2', y);
					gl.setAttribute('stroke', 'var(--grid)');
					gridG.appendChild(gl);
					let t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
					t.setAttribute('x', 6);
					t.setAttribute('y', y + 4);
					t.setAttribute('fill', '#94a3b8');
					t.textContent = p;
					axisG.appendChild(t);
				}
				lineEl.setAttribute('points', view.map((p, i) => `${i*(W/(maxPoints-1))},${(maxY-p)/(maxY-minY)*H}`).join(' '));
				tradesG.innerHTML = '';
				trades.forEach(t => {
					if (t.i < startIndex || t.i >= startIndex + maxPoints) return;
					const i = t.i - startIndex,
						x = i * (W / (maxPoints - 1)),
						y = (maxY - t.p) / (maxY - minY) * H,
						l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
					l.setAttribute('x1', x);
					l.setAttribute('x2', x);
					l.setAttribute('y1', y);
					l.setAttribute('y2', H);
					l.setAttribute('stroke', t.type === 'buy' ? 'var(--green)' : 'var(--red)');
					l.setAttribute('stroke-width', 2);
					tradesG.appendChild(l);
				});
			}

			function drawOverview() {
				if (data.length < 2) return;
				const center = price,
					range = 300,
					min = center - range,
					max = center + range;
				overviewLine.setAttribute('points', data.map((p, i) => {
					const x = i / (data.length - 1) * OW,
						y = (max - p) / (max - min) * OH;
					return `${x},${y}`
				}).join(' '));
			}

			/* ===== simulate ===== */
			function simulate() {
				if (delisted) return; // å·²ä¸‹å¸‚åˆ™ä¸å†æ¨¡æ‹Ÿä»·æ ¼
				let vol = 50;
				if (Math.random() < 0.03) {
					vol = 150;
					shock = 2.5;
				}

				// æ­£å¸¸ä»·æ ¼æ³¢åŠ¨
				price = Math.max(1, price + (Math.random() - 0.5) * vol * shock);
				shock *= 0.9;
				data.push(price);

				// è‚¡ç¥¨ä»·æ ¼è·Œåˆ°1æˆ–ä»¥ä¸‹æ—¶è§¦å‘ä¸‹å¸‚
				if (price <= 1 && !delisted) {
					delisted = true; // æ ‡è®°ä¸ºä¸‹å¸‚
					delistMask.style.display = 'flex'; // æ˜¾ç¤ºä¸‹å¸‚é¢æ¿

					//const delistDuration = 5000 + Math.random() * 10000; // ä¸‹å¸‚æ—¶é—´
					let remaining = 3; // ç§’æ•°å€’è®¡æ—¶

					// æ¯ç§’æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
					const timer = setInterval(() => {
						delistMask.querySelector('p').textContent = `ç­‰å¾…é‡æ–°ä¸Šå¸‚... ${remaining} ç§’`;
						remaining--;
					}, 1000);

					// åˆ°æ—¶é—´å¤å¸‚
					setTimeout(() => {
						price = 100; // å¤å¸‚ä»·æ ¼
						delisted = false;
						delistMask.style.display = 'none'; // éšè—ä¸‹å¸‚é¢æ¿
						clearInterval(timer); // åœæ­¢å€’è®¡æ—¶
					}, 3000);
				}
			}
			/* ===== tick ===== */
			function tick() {
				if (!alive) return;
				simulate();
				if (money >= 2000) unlock('banker', 'é“¶è¡Œå®¶');
				if (money >= 5000) unlock('senior', 'èµ„æ·±é“¶è¡Œå®¶');
				if (!achv.still && Date.now() - lastTradeTime >= 30000) unlock('still', 'ä¸åŠ¨å¦‚å±±');
				checkBankrupt();
				ui();
			}
			setInterval(tick, tickInterval);
			/* ===== render ===== */
			function render() {
				if (alive) {
					draw();
					drawOverview();
				}
				requestAnimationFrame(render);
			}
			render();

			/* ===== trade ===== */
			function doBuy(q) {
				if (!alive || money < price * q || delisted) return;
				money -= price * q;
				stock += q;
				trades.push({
					i: data.length - 1,
					p: price,
					type: 'buy'
				});
				lastTradeTime = Date.now();
				if (price > 400) unlock('rich', 'æœ‰é’±äºº');
				tradeTimes.push(Date.now());
				tradeTimes = tradeTimes.filter(t => Date.now() - t <= 5000);
				if (!achv.fast && tradeTimes.length >= 10) unlock('fast', 'æ‰‹é€Ÿé£å¿«');
				unlock('first', 'ç¬¬ä¸€æ¬¡äº¤æ˜“');
				ui();
			}

			function doSell(q) {
				if (!alive || stock < q || delisted) return;
				money += price * q;
				stock -= q;
				const lastBuy = [...trades].reverse().find(t => t.type === 'buy');
				if (lastBuy && lastBuy.p - price >= 100) unlock('survivor', 'ç”Ÿå­˜è€…');
				trades.push({
					i: data.length - 1,
					p: price,
					type: 'sell'
				});
				lastTradeTime = Date.now();
				tradeTimes.push(Date.now());
				tradeTimes = tradeTimes.filter(t => Date.now() - t <= 5000);
				if (!achv.fast && tradeTimes.length >= 10) unlock('fast', 'æ‰‹é€Ÿé£å¿«');
				unlock('first', 'ç¬¬ä¸€æ¬¡äº¤æ˜“');
				ui();
			}
			buy.onclick = () => doBuy(buyQty);
			sell.onclick = () => doSell(sellQty);

			/* ===== trade qty controls ===== */
			incBuy.onclick = () => {
				buyQty++;
				buyAmount.textContent = buyQty;
			}
			decBuy.onclick = () => {
				buyQty = Math.max(1, buyQty - 1);
				buyAmount.textContent = buyQty;
			}
			incSell.onclick = () => {
				sellQty++;
				sellAmount.textContent = sellQty;
			}
			decSell.onclick = () => {
				sellQty = Math.max(1, sellQty - 1);
				sellAmount.textContent = sellQty;
			}

			/* ===== news ===== */
			const newsList = ['âš ï¸ å·¨é‡èµ„é‡‘ç¬é—´æ’¤ç¦»å¸‚åœºï¼ŒæµåŠ¨æ€§æ€¥å‰§æ¯ç«­', 'ğŸ’¥ ç³»ç»Ÿæ€§é£é™©çˆ†å‘ï¼Œå¸‚åœºè¿›å…¥å¤±æ§çŠ¶æ€', 'ğŸŒ å…¨çƒèµ„æœ¬ææ…Œæ€§é‡é…ï¼Œé¿é™©æƒ…ç»ªé£™å‡', 'ğŸ“‰ è¿é”æ¸…ç®—è§¦å‘ï¼Œå¸‚åœºå‡ºç°ç€‘å¸ƒå¼ä¸‹è·Œ',
				'ğŸ“ˆ æ”¿ç­–æ ¸å¼¹çº§åˆºæ¿€é‡Šæ”¾ï¼Œèµ„é‡‘ç–¯ç‹‚æ¶Œå…¥', 'ğŸ¦ å¤šå®¶å¤§å‹æœºæ„ç´§æ€¥è°ƒæ•´å¤´å¯¸ï¼Œæ–¹å‘ä¸æ˜', 'âš¡ ç®—æ³•äº¤æ˜“å…¨é¢æ¥ç®¡å¸‚åœºï¼Œäººç±»äº¤æ˜“å‘˜é€€åœº', 'ğŸš¨ ç›‘ç®¡çªå‘å£°æ˜ï¼Œå¸‚åœºè¿›å…¥é«˜åº¦ä¸ç¡®å®šæœŸ',
				'ğŸ§  æœ‰äº¤æ˜“å‘˜å£°ç§°â€œè¿™ä¸æ˜¯éšæœºæ³¢åŠ¨â€', 'ğŸ§ª éšæœºå‡½æ•°è¡¨ç¤ºï¼šæˆ‘ä¹Ÿæ²¡æƒ³åˆ°ä¼šè¿™æ ·', 'ğŸ€ å¸‚åœºå…±è¯†è¢«é‡æ–°å®šä¹‰ä¸ºâ€œè¿æ°”â€', 'ğŸ˜• è‘—åç»æµå­¦å®¶æ°åŸºè¡¨ç¤ºï¼Œå½“å‰è‚¡å¸‚å·²æ— å¯æ•‘è¯'
			];
			setInterval(() => {
				if (!alive) return;
				const d = document.createElement('div');
				d.className = 'news';
				d.textContent = newsList[Math.floor(Math.random() * newsList.length)];
				document.body.appendChild(d);
				shock = 3;
				setTimeout(() => d.remove(), 5000);
			}, 15000);

			/* ===== achievements render ===== */
			const achvMeta = [{
				k: 'first',
				name: 'ç¬¬ä¸€æ¬¡äº¤æ˜“',
				desc: 'è¿›è¡Œä¸€æ¬¡ä¹°å…¥'
			}, {
				k: 'banker',
				name: 'é“¶è¡Œå®¶',
				desc: 'èµ„äº§è¾¾åˆ° $2000'
			}, {
				k: 'senior',
				name: 'èµ„æ·±é“¶è¡Œå®¶',
				desc: 'èµ„äº§è¾¾åˆ° $5000'
			}, {
				k: 'survivor',
				name: 'ç”Ÿå­˜è€…',
				desc: 'å•æ¬¡ä¹°å–äºæŸ â‰¥ $100ï¼Œä¸”æœªç ´äº§'
			}, {
				k: 'rich',
				name: 'æœ‰é’±äºº',
				desc: 'åœ¨ä»·æ ¼ > $400 æ—¶ä¹°å…¥'
			}, {
				k: 'still',
				name: 'ä¸åŠ¨å¦‚å±±',
				desc: 'è¶…è¿‡30ç§’æœªè¿›è¡Œä»»ä½•äº¤æ˜“'
			}, {
				k: 'fast',
				name: 'æ‰‹é€Ÿé£å¿«',
				desc: '5ç§’å†…å®Œæˆ10æ¬¡äº¤æ˜“'
			}, {
				k: 'alive',
				name: 'å±…ç„¶æ´»åˆ°ç°åœ¨',
				desc: 'ç ´äº§'
			}];

			function renderAchv() {
				achvList.innerHTML = '';
				achvMeta.forEach(a => {
					const ok = achv[a.k];
					const d = document.createElement('div');
					d.className = 'achvItem ' + (ok ? 'unlocked' : 'locked');
					d.innerHTML =
						`<div style="font-size:16px;margin-bottom:4px">${ok?'ğŸ†':'ğŸ”’'} ${a.name}</div><div style="font-size:12px;opacity:.8;line-height:1.4">${a.desc}</div>`;
					achvList.appendChild(d);
				});
			}
			achvBtn.onclick = () => {
				renderAchv();
				achvMask.style.display = 'flex';
			};
			achvMask.onclick = e => {
				if (e.target === achvMask) achvMask.style.display = 'none';
			};

			/* ===== rules ===== */
			ruleBtn.onclick = () => {
				ruleMask.style.display = 'flex';
			};
			ruleMask.onclick = e => {
				if (e.target === ruleMask) ruleMask.style.display = 'none';
			};

			/* ===== bankrupt ===== */
			function checkBankrupt() {
				if (money < price && stock === 0 && !delisted) {
					alive = false;
					deadInfo.textContent = `æœ€ç»ˆèµ„äº§ï¼š$${money.toFixed(2)}`;
					deadMask.style.display = 'flex';
					unlock('alive', 'å±…ç„¶æ´»åˆ°ç°åœ¨');
				}
			}

			/* ===== rank system ===== */
			const RANK_KEY = 'zhujingqistockgamerank';
			const RANK_API = 'https://api.textdb.online/update/';
			async function loadRank() {
				try {
					const r = await fetch(`https://textdb.online/${RANK_KEY}`);
					if (r.ok) {
						const t = await r.text();
						return t ? t ? JSON.parse(t) : [] : [];
					}
				} catch (e) {}
				return [];
			}
			async function saveRank(list) {
				await fetch(`${RANK_API}?key=${RANK_KEY}&value=${encodeURIComponent(JSON.stringify(list))}`);
			}
			updateRankBtn.onclick = async () => {
				if (!alive) return;
				const name = prompt('è¯·è¾“å…¥ä½ çš„åå­—ï¼š');
				if (!name) return;
				let list = await loadRank();
				const old = list.find(i => i.name === name);
				if (old) {
					if (old.max >= money) return;
					old.max = money;
					old.time = new Date().toLocaleString();
				} else {
					list.push({
						name,
						max: money,
						time: new Date().toLocaleString()
					});
				}
				list.sort((a, b) => b.max - a.max);
				list = list.slice(0, 10);
				await saveRank(list);
			};
			rankBtn.onclick = async () => {
				rankList.innerHTML = 'åŠ è½½ä¸­...';
				rankMask.style.display = 'flex';
				const list = await loadRank();
				rankList.innerHTML = '';
				list.forEach((r, i) => {
					const d = document.createElement('div');
					d.className = 'rankItem';
					d.innerHTML = `<div>${i+1}. ${r.name}</div><div>$${r.max.toFixed(2)}</div>`;
					rankList.appendChild(d);
				});
			};
			rankMask.onclick = e => {
				if (e.target === rankMask) rankMask.style.display = 'none';
			};

			/* ===== misc ===== */
			document.addEventListener('contextmenu', e => e.preventDefault());
			setInterval(() => {
				updateRankBtn.textContent = `â¬†ï¸ æäº¤ç›®å‰é‡‘é¢($${money.toFixed(0)})è‡³æ’è¡Œæ¦œ `;
			}, 1000);
		</script>

	</body>
</html>


