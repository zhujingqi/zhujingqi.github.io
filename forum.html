<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>ç•™è¨€ - Zhujingqi</title>
		<link id="maincss" rel="stylesheet" href="/css/main.css">
		<link id="barcss" rel="stylesheet" href="/css/bar.css">
		<style>
			.msgdiv {
				max-width: 800px;
				margin: auto;
			}

			#messages {
				white-space: pre-wrap;
				background: #fff;
				padding: 1em;
				border-radius: 8px;
				border: 1px solid #ccc;
				height: 400px;
				overflow-y: auto;
				margin-bottom: 1em;
			}

			input,
			textarea,
			button {
				display: block;
				width: 100%;
				margin-top: 0.5em;
				font-size: 1em;
			}

			input,
			textarea {
				padding: 0.5em;
				border-radius: 6px;
				border: 1px solid #ccc;
			}

			button {
				background-color: #007BFF;
				color: white;
				border: none;
				padding: 0.7em;
				border-radius: 6px;
				cursor: pointer;
			}

			button:hover {
				background-color: #0056b3;
			}

			.status {
				margin-top: 1em;
				color: gray;
			}
		</style>
	</head>
	<body>
		<div class="bar">
			<a href="/index.html" class="zjq"><b>Zhujingqi</b></a>
			<a href="#">ç•™è¨€æ¿</a>
		</div>
		<div class="text">
			<div class="msgdiv">
				<div id="messages">Loading...</div>
				<label for="nickname">åå­—</label>
				<input type="text" id="nickname" placeholder="ä½ çš„åå­—">
				<label for="newMessage">å†…å®¹</label>
				<textarea id="newMessage" rows="3" placeholder="è¯„è®ºå†…å®¹"></textarea>
				<button onclick="submitMessage()">ğŸ“¨ å‘è¡¨ç•™è¨€</button>
				<div class="status" id="statusText"></div>
			</div>
		</div>
		<div class="text">
			æ³¨æ„äº‹é¡¹<br>
			1. æ•°æ®æ›´æ–°é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œè¯·å‹¿é¢‘ç¹æ“ä½œã€‚<br>
			2. ä¸¥ç¦å‘è¡¨ä¸è‰¯ã€éæ³•è¯„è®ºï¼<br>
		</div>
		<div class="bottom">
			<a href="/index.html"><b>Zhujingqi</b></a>
			<a href="/about.html">å…³äº</a>
			<a href="/money.html">èµåŠ©</a>
		</div>
		<noscript>
			<style>
				body {
					display: none;
				}
			</style>
			æ‚¨çš„æµè§ˆå™¨æœªå¯ç”¨æˆ–ä¸æ”¯æŒ JavaScriptï¼Œæœ¬ç«™æ— æ³•æ­£å¸¸è¿è¡Œã€‚
		</noscript>
		<script>
			const dbKey = 'zhujingqicomtextdbonline'; // TextDB.online key
			const dbReadURL = 'https://textdb.online/' + dbKey;
			const dbWriteURL = 'https://api.textdb.online/update/';
			const messagesDiv = document.getElementById('messages');
			const status = document.getElementById('statusText');
			// Load
			async function loadMessages() {
				try {
					const res = await fetch(dbReadURL);
					const text = await res.text();
					messagesDiv.innerHTML = text || "è¿˜æ²¡æœ‰äººç•™è¨€ï¼Œå¿«æ¥ç•™è¨€å§ï¼";
					status.innerText = "âœ… Loaded.";
				} catch (err) {
					messagesDiv.textContent = "âš ï¸ ERROR";
					status.innerText = "âŒ Please check your network.";
				}
			}
			// Summit
			async function submitMessage() {
				const name = document.getElementById('nickname').value.trim() || "åŒ¿å";
				const message = document.getElementById('newMessage').value.trim();
				if (!message) {
					alert("è¯·å¡«å†™ç•™è¨€å†…å®¹ï¼");
					return;
				}
				const timestamp = new Date().toLocaleString();
				const newEntry =
					`<span style="color: gray;">[${timestamp}]</span><br><strong>${name}</strong>: ${message}<br>\n`;
				try {
					// Get old content
					const res = await fetch(dbReadURL);
					const oldText = await res.text();
					// Create POST
					const params = new URLSearchParams();
					params.append('key', dbKey);
					params.append('value', oldText + newEntry);
					// send POST
					const updateRes = await fetch(dbWriteURL, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded'
						},
						body: params.toString()
					});
					const result = await updateRes.json();
					if (result.status !== 1) throw new Error("API ERROR");
					// Refresh
					document.getElementById('newMessage').value = '';
					loadMessages();
					status.innerText = "âœ… Sentï¼";
				} catch (err) {
					console.error(err);
					status.innerText = "âŒ ERROR";
				}
			}
			loadMessages();
			messagesDiv.scrollTop = messagesDiv.scrollHeight;
		</script>
	</body>
</html>
